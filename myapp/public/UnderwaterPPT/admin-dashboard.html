<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Underwater Learning</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{font-family:'Kanit',sans-serif;box-sizing:border-box}
        body{background:#f4f6f8;min-height:100vh;margin:0}
        .side{position:fixed;top:0;left:0;width:220px;height:100vh;background:linear-gradient(180deg,#0f172a,#1e293b);padding:15px 0;z-index:100;overflow-y:auto;transition:0.3s}
        .side-brand{padding:15px 20px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:10px;color:#fff}
        .side-menu a{display:flex;align-items:center;gap:12px;padding:12px 20px;color:rgba(255,255,255,.7);text-decoration:none;transition:.2s;border-left:4px solid transparent}
        .side-menu a:hover,.side-menu a.on{background:rgba(255,255,255,.05);color:#fff;border-left-color:#0ea5e9}
        .main{margin-left:220px;padding:25px;min-height:100vh}
        .top{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:15px 25px;border-radius:12px;margin-bottom:25px;box-shadow:0 4px 6px -1px rgba(0,0,0,.05)}
        .card{background:#fff;border-radius:12px;padding:20px;border:none;box-shadow:0 2px 4px rgba(0,0,0,.05);margin-bottom:20px}
        .page{display:none}.page.on{display:block;animation:fadeIn .3s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .btn-xs{padding:4px 8px;font-size:.75rem;border-radius:6px}
        @media(max-width:768px){.side{transform:translateX(-100%)}.side.show{transform:translateX(0)}.main{margin-left:0}}
    </style>
</head>
<body>

<div class="side" id="side">
    <div class="side-brand"><h5 class="mb-0"><i class="bi bi-water me-2"></i>Admin Panel</h5></div>
    <div class="side-menu">
        <a href="#" class="on" data-p="dash"><i class="bi bi-grid"></i>Dashboard</a>
        <a href="#" data-p="lessons"><i class="bi bi-book"></i>‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</a>
        <a href="#" data-p="videos"><i class="bi bi-play-circle"></i>‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</a>
        <a href="#" data-p="games"><i class="bi bi-controller"></i>‡πÄ‡∏Å‡∏°</a>
        <a href="#" data-p="quizzes"><i class="bi bi-patch-question"></i>‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</a>
        <a href="#" data-p="news"><i class="bi bi-newspaper"></i>‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</a>
        <div style="height:1px;background:rgba(255,255,255,.1);margin:10px 20px"></div>
        <a href="#" data-p="settings"><i class="bi bi-gear"></i>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
        <a href="index.html" target="_blank"><i class="bi bi-box-arrow-up-right"></i>‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</a>
    </div>
</div>

<div class="main">
    <div class="top">
        <div class="d-flex align-items-center">
            <button class="btn btn-light d-md-none me-3" onclick="document.getElementById('side').classList.toggle('show')"><i class="bi bi-list"></i></button>
            <h5 class="mb-0 fw-bold" id="page-title">Dashboard</h5>
        </div>
        <button class="btn btn-danger btn-sm" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div class="page on" id="p-dash">
        <div class="row g-3 mb-4">
            <div class="col-6 col-md-4 col-xl-2"><div class="card h-100 text-center py-3"><h3 class="fw-bold text-primary" id="s-views">0</h3><small class="text-muted">‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</small></div></div>
            <div class="col-6 col-md-4 col-xl-2"><div class="card h-100 text-center py-3"><h3 class="fw-bold text-success" id="s-lessons">0</h3><small class="text-muted">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</small></div></div>
            <div class="col-6 col-md-4 col-xl-2"><div class="card h-100 text-center py-3"><h3 class="fw-bold text-danger" id="s-videos">0</h3><small class="text-muted">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</small></div></div>
            <div class="col-6 col-md-4 col-xl-2"><div class="card h-100 text-center py-3"><h3 class="fw-bold text-warning" id="s-games">0</h3><small class="text-muted">‡πÄ‡∏Å‡∏°</small></div></div>
            <div class="col-6 col-md-4 col-xl-2"><div class="card h-100 text-center py-3"><h3 class="fw-bold text-info" id="s-quizzes">0</h3><small class="text-muted">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</small></div></div>
            <div class="col-6 col-md-4 col-xl-2"><div class="card h-100 text-center py-3"><h3 class="fw-bold text-secondary" id="s-news">0</h3><small class="text-muted">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</small></div></div>
        </div>
    </div>

    <div class="page" id="p-lessons">
        <div class="card">
            <div class="d-flex justify-content-between mb-3"><h5>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5><button class="btn btn-success btn-sm" onclick="openM('lesson')"><i class="bi bi-plus-lg"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button></div>
            <table class="table table-hover"><thead><tr><th>#</th><th>‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏´‡∏°‡∏ß‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="tbl-lessons"></tbody></table>
        </div>
    </div>

    <div class="page" id="p-videos">
        <div class="card">
            <div class="d-flex justify-content-between mb-3"><h5>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</h5><button class="btn btn-success btn-sm" onclick="openM('video')"><i class="bi bi-plus-lg"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</button></div>
            <table class="table table-hover"><thead><tr><th>#</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th><th>Youtube ID</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="tbl-videos"></tbody></table>
        </div>
    </div>

    <div class="page" id="p-games">
        <div class="card">
            <div class="d-flex justify-content-between mb-3"><h5>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏°</h5><button class="btn btn-success btn-sm" onclick="openM('game')"><i class="bi bi-plus-lg"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button></div>
            <table class="table table-hover"><thead><tr><th>#</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="tbl-games"></tbody></table>
        </div>
    </div>

    <div class="page" id="p-quizzes">
        <div class="card">
            <div class="d-flex justify-content-between mb-3"><h5>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h5><button class="btn btn-success btn-sm" onclick="openM('quiz')"><i class="bi bi-plus-lg"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</button></div>
            <table class="table table-hover"><thead><tr><th>#</th><th width="50%">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th><th>‡πÄ‡∏â‡∏•‡∏¢</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="tbl-quizzes"></tbody></table>
        </div>
    </div>

    <div class="page" id="p-news">
        <div class="card">
            <div class="d-flex justify-content-between mb-3"><h5>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h5><button class="btn btn-success btn-sm" onclick="openM('news')"><i class="bi bi-plus-lg"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß</button></div>
            <table class="table table-hover"><thead><tr><th>#</th><th>‡∏£‡∏π‡∏õ</th><th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th><th>‡∏´‡∏°‡∏ß‡∏î</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="tbl-news"></tbody></table>
        </div>
    </div>

    <div class="page" id="p-settings">
        <div class="card" style="max-width:500px">
            <h5>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h5>
            <button class="btn btn-outline-danger w-100" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>
</div>

<div class="modal fade" id="lessonM"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="lessonMT">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="l-id"><div class="mb-2"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><input id="l-title" class="form-control"></div><div class="mb-2"><label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label><select id="l-cat" class="form-select"><option value="coral">‡∏õ‡∏∞‡∏Å‡∏≤‡∏£‡∏±‡∏á</option><option value="animals">‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏∞‡πÄ‡∏•</option><option value="conservation">‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå</option><option value="ecosystem">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏¥‡πÄ‡∏ß‡∏®</option></select></div><div class="mb-2"><label>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</label><textarea id="l-content" class="form-control" rows="3"></textarea></div><div class="mb-2"><label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û URL</label><input id="l-img" class="form-control"></div><div class="form-check"><input type="checkbox" id="l-active" class="form-check-input" checked><label>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label></div></div><div class="modal-footer"><button class="btn btn-primary" onclick="saveL()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></div></div></div>

<div class="modal fade" id="videoM"><div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title" id="videoMT">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
        <input type="hidden" id="v-id">
        <div class="mb-2"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</label><input id="v-title" class="form-control"></div>
        <div class="mb-2"><label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label><select id="v-cat" class="form-select"><option value="general">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option><option value="documentary">‡∏™‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ</option><option value="tutorial">‡∏™‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</option><option value="adventure">‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢</option></select></div>
        <div class="mb-2"><label>Youtube ID</label><input id="v-url" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô dQw4w9WgXcQ"></div>
        <div class="mb-2"><label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label><textarea id="v-desc" class="form-control" rows="2"></textarea></div>
        <div class="form-check"><input type="checkbox" id="v-active" class="form-check-input" checked><label>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label></div>
    </div>
    <div class="modal-footer"><button class="btn btn-primary" onclick="saveV()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
</div></div></div>

<div class="modal fade" id="gameM"><div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title" id="gameMT">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
        <input type="hidden" id="g-id">
        <div class="mb-2"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°</label><input id="g-title" class="form-control"></div>
        <div class="mb-2"><label>‡∏£‡∏∞‡∏î‡∏±‡∏ö</label><select id="g-diff" class="form-select"><option value="easy">‡∏á‡πà‡∏≤‡∏¢</option><option value="medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option><option value="hard">‡∏¢‡∏≤‡∏Å</option></select></div>
        <div class="mb-2"><label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û URL</label><input id="g-img" class="form-control"></div>
        <div class="mb-2"><label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏° (URL)</label><input id="g-link" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏¥‡∏á‡∏Å‡πå Embed ‡∏à‡∏≤‡∏Å Wordwall"></div>
        <div class="form-check"><input type="checkbox" id="g-active" class="form-check-input" checked><label>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label></div>
    </div>
    <div class="modal-footer"><button class="btn btn-primary" onclick="saveG()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
</div></div></div>

<div class="modal fade" id="quizM"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quizMT">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="q-id"><div class="mb-2"><label>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label><textarea id="q-q" class="form-control" rows="2"></textarea></div><div class="row g-2 mb-2"><div class="col-6"><input id="q-o1" class="form-control" placeholder="‡∏Å."></div><div class="col-6"><input id="q-o2" class="form-control" placeholder="‡∏Ç."></div><div class="col-6"><input id="q-o3" class="form-control" placeholder="‡∏Ñ."></div><div class="col-6"><input id="q-o4" class="form-control" placeholder="‡∏á."></div></div><div class="mb-2"><label>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å</label><select id="q-ans" class="form-select"><option value="0">‡∏Ç‡πâ‡∏≠ ‡∏Å.</option><option value="1">‡∏Ç‡πâ‡∏≠ ‡∏Ç.</option><option value="2">‡∏Ç‡πâ‡∏≠ ‡∏Ñ.</option><option value="3">‡∏Ç‡πâ‡∏≠ ‡∏á.</option></select></div><div class="form-check"><input type="checkbox" id="q-active" class="form-check-input" checked><label>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label></div></div><div class="modal-footer"><button class="btn btn-primary" onclick="saveQ()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></div></div></div>

<div class="modal fade" id="newsM"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="newsMT">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="n-id"><div class="mb-2"><label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label><input id="n-title" class="form-control"></div><div class="row g-2 mb-2"><div class="col-6"><label>‡∏´‡∏°‡∏ß‡∏î</label><select id="n-cat" class="form-select"><option>Marine Science</option><option>Conservation</option><option>Environment</option></select></div><div class="col-6"><label>‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤</label><input id="n-source" class="form-control" value="Underwater Learning"></div></div><div class="mb-2"><label>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</label><textarea id="n-content" class="form-control" rows="4"></textarea></div><div class="mb-2"><label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û URL</label><input id="n-img" class="form-control"></div></div><div class="modal-footer"><button class="btn btn-primary" onclick="saveN()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // üî• Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyAifapE2aLzu3UUDsWwVaNK5OhwgTo0x0Y",
        authDomain: "ppt21-92f97.firebaseapp.com",
        projectId: "ppt21-92f97",
        storageBucket: "ppt21-92f97.firebasestorage.app",
        messagingSenderId: "171020058825",
        appId: "1:171020058825:web:2a6216cb9bfece19cf8d18",
        measurementId: "G-6J5D16LK4Q"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Global Functions
    window.saveL = () => saveData('lessons');
    window.saveV = () => saveData('videos');
    window.saveG = () => saveData('games');
    window.saveQ = () => saveData('quizzes');
    window.saveN = () => saveData('news');
    window.del = (type, id) => delItem(type, id);
    window.editL = (id) => editItem('lessons', id);
    window.editV = (id) => editItem('videos', id);
    window.editG = (id) => editItem('games', id);
    window.editQ = (id) => editItem('quizzes', id);
    window.editN = (id) => editItem('news', id);
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    window.openM = (t) => {
        const p = t.charAt(0);
        document.getElementById(p + '-id').value = '';
        document.getElementById(t + 'MT').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'; // Reset ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        document.querySelectorAll(`#${t}M input, #${t}M textarea`).forEach(i => { if(i.type!=='checkbox') i.value='' });
        new bootstrap.Modal(document.getElementById(t + 'M')).show();
    };
    
    window.logout = () => { localStorage.removeItem('adminOK'); window.location.href='login.html'; };

    let allData = { lessons:[], videos:[], games:[], quizzes:[], news:[] };

    async function loadData() {
        const colls = ['lessons', 'videos', 'games', 'quizzes', 'news'];
        for (const c of colls) {
            const q = query(collection(db, c));
            const snapshot = await getDocs(q);
            allData[c] = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
        }
        render();
    }

    function render() {
        const $ = id => document.getElementById(id);
        const CAT = {coral:'‡∏õ‡∏∞‡∏Å‡∏≤‡∏£‡∏±‡∏á', animals:'‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏∞‡πÄ‡∏•', conservation:'‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå', ecosystem:'‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏¥‡πÄ‡∏ß‡∏®'};
        const VCAT = {general:'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', documentary:'‡∏™‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ', tutorial:'‡∏™‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ', adventure:'‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢'};

        $('s-lessons').textContent = allData.lessons.length;
        $('s-videos').textContent = allData.videos.length;
        $('s-games').textContent = allData.games.length;
        $('s-quizzes').textContent = allData.quizzes.length;
        $('s-news').textContent = allData.news.length;

        // Render Tables
        $('tbl-videos').innerHTML = allData.videos.map(x => `<tr><td>#</td><td>${x.title}</td><td><span class="badge bg-info text-dark">${VCAT[x.category] || x.category || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</span></td><td><code>${x.url}</code></td><td><span class="badge ${x.active?'bg-success':'bg-danger'}">${x.active?'‡πÄ‡∏õ‡∏¥‡∏î':'‡∏õ‡∏¥‡∏î'}</span></td><td><button class="btn btn-outline-primary btn-xs" onclick="editV('${x.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-outline-danger btn-xs" onclick="del('videos','${x.id}')"><i class="bi bi-trash"></i></button></td></tr>`).join('');
        $('tbl-news').innerHTML = allData.news.map(x => `<tr><td>#</td><td><img src="${x.image}" style="width:50px"></td><td>${x.title}</td><td>${x.category}</td><td>${x.date}</td><td><button class="btn btn-outline-primary btn-xs" onclick="editN('${x.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-outline-danger btn-xs" onclick="del('news','${x.id}')"><i class="bi bi-trash"></i></button></td></tr>`).join('');
        $('tbl-lessons').innerHTML = allData.lessons.map(x => `<tr><td>#</td><td><img src="${x.image}" style="width:50px"></td><td>${x.title}</td><td>${CAT[x.category]||x.category}</td><td><span class="badge ${x.active?'bg-success':'bg-danger'}">${x.active?'‡πÄ‡∏õ‡∏¥‡∏î':'‡∏õ‡∏¥‡∏î'}</span></td><td><button class="btn btn-outline-primary btn-xs" onclick="editL('${x.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-outline-danger btn-xs" onclick="del('lessons','${x.id}')"><i class="bi bi-trash"></i></button></td></tr>`).join('');
        $('tbl-games').innerHTML = allData.games.map(x => `<tr><td>#</td><td>${x.title}</td><td>${x.difficulty}</td><td><span class="badge ${x.active?'bg-success':'bg-danger'}">${x.active?'‡πÄ‡∏õ‡∏¥‡∏î':'‡∏õ‡∏¥‡∏î'}</span></td><td><button class="btn btn-outline-primary btn-xs" onclick="editG('${x.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-outline-danger btn-xs" onclick="del('games','${x.id}')"><i class="bi bi-trash"></i></button></td></tr>`).join('');
        $('tbl-quizzes').innerHTML = allData.quizzes.map(x => `<tr><td>#</td><td>${x.q.substring(0,30)}...</td><td>${['‡∏Å','‡∏Ç','‡∏Ñ','‡∏á'][x.ans]}</td><td><span class="badge ${x.active?'bg-success':'bg-danger'}">${x.active?'‡πÄ‡∏õ‡∏¥‡∏î':'‡∏õ‡∏¥‡∏î'}</span></td><td><button class="btn btn-outline-primary btn-xs" onclick="editQ('${x.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-outline-danger btn-xs" onclick="del('quizzes','${x.id}')"><i class="bi bi-trash"></i></button></td></tr>`).join('');
    }

    async function saveData(type) {
        const p = type.charAt(0);
        const id = document.getElementById(p + '-id').value;
        let data = {};

        if(type==='lessons') data = { title:document.getElementById('l-title').value, category:document.getElementById('l-cat').value, content:document.getElementById('l-content').value, image:document.getElementById('l-img').value, active:document.getElementById('l-active').checked };
        if(type==='news') data = { 
            title:document.getElementById('n-title').value, 
            category:document.getElementById('n-cat').value, 
            source:document.getElementById('n-source').value || 'Underwater Learning', 
            content:document.getElementById('n-content').value, 
            image:document.getElementById('n-img').value, 
            date:new Date().toISOString().split('T')[0] 
        };
        if(type==='videos') data = { title:document.getElementById('v-title').value, url:document.getElementById('v-url').value, desc:document.getElementById('v-desc').value, category:document.getElementById('v-cat').value, active:document.getElementById('v-active').checked };
        if(type==='games') data = { title:document.getElementById('g-title').value, difficulty:document.getElementById('g-diff').value, image:document.getElementById('g-img').value, link:document.getElementById('g-link').value, active:document.getElementById('g-active').checked };
        if(type==='quizzes') data = { q:document.getElementById('q-q').value, opts:[document.getElementById('q-o1').value, document.getElementById('q-o2').value, document.getElementById('q-o3').value, document.getElementById('q-o4').value], ans:document.getElementById('q-ans').value, active:document.getElementById('q-active').checked };

        try {
            if (id) { await updateDoc(doc(db, type, id), data); } else { await addDoc(collection(db, type), data); }
            bootstrap.Modal.getInstance(document.querySelector('.modal.show')).hide();
            loadData();
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        } catch (e) { alert("Error: " + e.message); }
    }

    async function delItem(type, id) {
        if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?")) return;
        await deleteDoc(doc(db, type, id));
        loadData();
    }

    // üî• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å ID)
    function editItem(type, id) {
        const item = allData[type].find(i => i.id === id);
        const p = type.charAt(0);
        
        // 1. Map ‡∏ä‡∏∑‡πà‡∏≠ Modal ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡πä‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏¥‡∏î)
        const modalMap = {
            'lessons': 'lessonM',
            'videos': 'videoM',
            'games': 'gameM',
            'quizzes': 'quizM',
            'news': 'newsM'
        };
        const modalID = modalMap[type];

        // 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Hidden ID ‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ Modal
        document.getElementById(p + '-id').value = id;
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ: ‡πÉ‡∏ä‡πâ modalID + 'T' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ ID ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô newsMT)
        const titleElem = document.getElementById(modalID + 'T'); 
        if(titleElem) titleElem.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';

        // 3. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏™‡πà Form
        if (type === 'lessons') {
            document.getElementById('l-title').value = item.title;
            document.getElementById('l-cat').value = item.category;
            document.getElementById('l-content').value = item.content;
            document.getElementById('l-img').value = item.image;
            document.getElementById('l-active').checked = item.active;
        } else if (type === 'videos') {
            document.getElementById('v-title').value = item.title;
            document.getElementById('v-url').value = item.url;
            document.getElementById('v-desc').value = item.desc;
            document.getElementById('v-cat').value = item.category || 'general';
            document.getElementById('v-active').checked = item.active;
        } else if (type === 'news') {
            document.getElementById('n-title').value = item.title;
            document.getElementById('n-content').value = item.content;
            document.getElementById('n-img').value = item.image;
            document.getElementById('n-cat').value = item.category;
            document.getElementById('n-source').value = item.source || ''; 
        } else if (type === 'games') {
            document.getElementById('g-title').value = item.title;
            document.getElementById('g-img').value = item.image;
            document.getElementById('g-diff').value = item.difficulty;
            document.getElementById('g-link').value = item.link || '';
            document.getElementById('g-active').checked = item.active;
        } else if (type === 'quizzes') {
            document.getElementById('q-q').value = item.q;
            document.getElementById('q-o1').value = item.opts[0];
            document.getElementById('q-o2').value = item.opts[1];
            document.getElementById('q-o3').value = item.opts[2];
            document.getElementById('q-o4').value = item.opts[3];
            document.getElementById('q-ans').value = item.ans;
            document.getElementById('q-active').checked = item.active;
        }
        
        // 4. ‡πÄ‡∏õ‡∏¥‡∏î Modal
        new bootstrap.Modal(document.getElementById(modalID)).show();
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    loadData();

    // Side Menu Logic
    document.querySelectorAll('.side-menu a[data-p]').forEach(a => {
        a.onclick = e => {
            e.preventDefault();
            document.querySelectorAll('.side-menu a').forEach(x => x.classList.remove('on'));
            a.classList.add('on');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
            const targetPage = document.getElementById('p-' + a.dataset.p);
            if (targetPage) {
                targetPage.classList.add('on');
                document.getElementById('page-title').textContent = a.textContent.trim();
            }
            if(window.innerWidth < 768) document.getElementById('side').classList.remove('show');
        };
    });
</script>
</body>
</html>